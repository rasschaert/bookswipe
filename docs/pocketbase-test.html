<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PocketBase SDK Test</title>
  </head>
  <body>
    <h1>PocketBase SDK Test</h1>
    <div id="status">Testing...</div>
    <div id="console"></div>

    <script>
      const logElement = document.getElementById("console");
      const statusElement = document.getElementById("status");

      function log(message) {
        console.log(message);
        logElement.innerHTML += `<p>${message}</p>`;
      }

      function setStatus(message) {
        statusElement.textContent = message;
      }

      async function testPocketBaseSDK() {
        try {
          setStatus("Loading PocketBase SDK...");

          // Load PocketBase SDK exactly like the main app
          const script = document.createElement("script");
          script.src =
            "https://cdn.jsdelivr.net/npm/pocketbase@0.21.3/dist/pocketbase.umd.js";

          await new Promise((resolve, reject) => {
            script.onload = () => {
              log("✅ PocketBase SDK loaded from CDN");
              resolve();
            };
            script.onerror = (error) => {
              log(`❌ Failed to load PocketBase SDK: ${error}`);
              reject(error);
            };
            document.head.appendChild(script);
          });

          setStatus("Initializing PocketBase...");

          // Check if PocketBase is available
          if (typeof PocketBase === "undefined") {
            throw new Error("PocketBase is not defined after loading SDK");
          }

          log("✅ PocketBase class is available");

          // Create PocketBase instance
          const pb = new PocketBase("https://adaptable-oxpecker.pikapod.net");
          log("✅ PocketBase instance created");

          setStatus("Testing health check...");
          const health = await pb.health.check();
          log(`✅ Health check successful: ${JSON.stringify(health)}`);

          setStatus("Fetching books...");
          const books = await pb.collection("books").getList(1, 3);
          log(`✅ Books fetched: ${books.items.length} books`);
          log(`First book: ${books.items[0]?.title || "None"}`);

          setStatus("✅ All PocketBase SDK tests passed!");
        } catch (error) {
          log(`❌ Error: ${error.message}`);
          log(`Stack: ${error.stack}`);
          setStatus(`❌ Failed: ${error.message}`);
        }
      }

      testPocketBaseSDK();
    </script>
  </body>
</html>
